<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>New Report - ASHA Saathi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8f9fa;
    }
    .container {
      max-width: 600px;
      margin-top: 40px;
    }
    .form-control, .btn {
      border-radius: 0.5rem;
    }
    .tab-content {
      margin-top: 20px;
    }
    .back-button {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
    }
    .mic-button {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background-color: #dc3545;
      color: white;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color 0.3s;
      position: relative;
    }
    .mic-button.recording {
      background-color: #a71d2a;
      box-shadow: 0 0 0 8px rgba(220, 53, 69, 0.3);
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.5);
      }
      70% {
        box-shadow: 0 0 0 12px rgba(220, 53, 69, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
      }
    }
    #audioPlayer {
      display: none;
      width: 100%;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container bg-white p-4 shadow rounded">
    <h3 class="text-center mb-4 text-primary">Create New Report</h3>

    <div class="mb-3">
      <label for="patientName" class="form-label">Patient Name</label>
      <input type="text" class="form-control" id="patientName" placeholder="Enter patient name" />
    </div>

    <ul class="nav nav-tabs mb-3" id="inputTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="voice-tab" data-bs-toggle="tab" data-bs-target="#voice" type="button" role="tab" aria-controls="voice" aria-selected="true">Voice</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="image-tab" data-bs-toggle="tab" data-bs-target="#image" type="button" role="tab" aria-controls="image" aria-selected="false">Image</button>
      </li>
    </ul>

    <div class="tab-content" id="inputTabsContent">
      <div class="tab-pane fade show active" id="voice" role="tabpanel" aria-labelledby="voice-tab">
        <div class="d-flex justify-content-center mb-3">
          <button id="micBtn" class="mic-button">
            <i class="bi bi-mic-fill"></i>
          </button>
        </div>
        <audio id="audioPlayer" controls></audio>
      </div>

      <div class="tab-pane fade" id="image" role="tabpanel" aria-labelledby="image-tab">
        <div class="mb-3">
          <label for="imageInputFile" class="form-label">Upload Image</label>
          <input type="file" class="form-control" id="imageInputFile" accept="image/*" />
        </div>
      </div>
    </div>

    <button class="btn btn-primary w-100" onclick="generateResult()">Generate Result</button>
  </div>

  <a href="index.html" class="btn btn-outline-secondary back-button">
    <i class="bi bi-arrow-left"></i> Back to Home
  </a>

  <script>
    let isRecording = false;
    let mediaRecorder;
    let audioChunks = [];

    document.getElementById("micBtn").addEventListener("click", async () => {
      const micBtn = document.getElementById("micBtn");

      if (!isRecording) {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.onstart = () => {
            isRecording = true;
            audioChunks = [];
            micBtn.classList.add("recording");
          };

          mediaRecorder.ondataavailable = event => {
            audioChunks.push(event.data);
          };

          mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            const audioUrl = URL.createObjectURL(audioBlob);
            const audioPlayer = document.getElementById("audioPlayer");
            audioPlayer.src = audioUrl;
            audioPlayer.style.display = "block";
            micBtn.classList.remove("recording");
            isRecording = false;
          };

          mediaRecorder.start();
        } catch (err) {
          alert("Microphone access denied or unavailable.");
        }
      } else {
        mediaRecorder.stop();
      }
    });

    function generateResult() {
      const name = document.getElementById("patientName").value.trim();

      if (!name) {
        alert("Please enter patient name before proceeding.");
        return;
      }

      window.location.href = "summary.html";
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  window.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    const name = params.get('name');
    if (name) {
      document.getElementById('patientName').value = decodeURIComponent(name);
    }
  });
</script>

</body>
</html>